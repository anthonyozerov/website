<!--#set var="title" value="Predicting rocket failure"-->
<!--#include virtual="/head.html"-->
<link rel="stylesheet" href="/stylesheets/prettified.css">
<!--#include virtual="/header.html"-->

<h2>Can rocket failure be predicted with a statistical model?</h2>
<p>Answer: Yes, but only somewhat well.</p>
<h3>Demonstration of the data used</h3>
<p>I used decades of data from NOAA to add the temperature variable to my model. Here is a demonstration of that data at an arbitrary point. An upwards trend in temperature is apparent.</p>
<img src="/research/rocketfailure/1.png" alt="The wiring schematic for the Columbia University Formula Racing Internal Combustion Engine racecar">
<h3>Hyperparameter tuning</h3>
<p>I used a logistic regression model to predict whether a rocket launch would succeed ("1") or fail ("0"). To decrease the coefficiencts on noisy variables, a cost function was added. The plot seen below is the output of a function I wrote that fits an arbitrary model (in this case, Logistic Regression) repeatedly while varying an arbitrary hyperparameter (in this case, C, the weight of the cost function). A low C means that the cost function was weighted very heavily, and a high C represents a very low weight.</p>
<img src="/research/rocketfailure/2.png" alt="The wiring schematic for the Columbia University Formula Racing Internal Combustion Engine racecar">
<h3>ROC curve</h3>
<p>Because different use-cases may necessitate different thresholds for deciding whether a rocket will fail or not, the model must be evaluated for every possible threshold. One method of doing this for a binary classifier is a receiver operating characteristic curve, which plots the true positive rate against the false positive rate as the threshold varies. Ideally, the area under the curve should be maximized (this area was the metric I used to choose a C value in the plot above). The plot below is the output of a function I wrote which generates and plots an ROC curve. It is evident that the model performs better than a coin toss (whose ROC curve would simply be a line x=y), but the area under the curve is not very large, at just 0.733.</p>
<img src="/research/rocketfailure/3.png" alt="The wiring schematic for the Columbia University Formula Racing Internal Combustion Engine racecar">
<p>Here is the code I used for this research. It's not particularly high-quality or well-documented. It is intended to be run block-by-block in an IPython notebook.</p>
<pre class="codeblock" style=""><span class="kwd">from</span><span class="pln">&nbsp;datetime&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;date</span><span class="pun">,</span><span class="pln">&nbsp;timedelta<br><br></span><span class="kwd">import</span><span class="pln">&nbsp;sys<br>sys</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'/home/aozerov/Dropbox/programming/jupyter'</span><span class="pun">)</span><span class="pln"><br><br></span><span class="kwd">from</span><span class="pln">&nbsp;netCDF4&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">Dataset</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;ftplib&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;FTP<br><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">linear_model&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">LogisticRegression</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">ensemble&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">RandomForestClassifier</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">neighbors&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">KNeighborsClassifier</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">tree&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">DecisionTreeClassifier</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">ensemble&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">GradientBoostingClassifier</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">svm&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;SVC<br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">neural_network&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">MLPClassifier</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;tree<br><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">feature_selection&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">SelectKBest</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">feature_selection&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">SelectPercentile</span><span class="pln"><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">feature_selection&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;f_classif<br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">feature_selection&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;chi2<br><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">model_selection&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;train_test_split<br><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">preprocessing&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;</span><span class="typ">Imputer</span><span class="pln"><br><br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">metrics&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;f1_score<br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">metrics&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;roc_auc_score<br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">metrics&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;mean_squared_error<br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">metrics&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;roc_curve<br></span><span class="kwd">from</span><span class="pln">&nbsp;sklearn</span><span class="pun">.</span><span class="pln">metrics&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;confusion_matrix<br><br></span><span class="kwd">from</span><span class="pln">&nbsp;</span><span class="typ">IPython</span><span class="pun">.</span><span class="pln">display&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;clear_output<br></span><span class="kwd">from</span><span class="pln">&nbsp;</span><span class="typ">IPython</span><span class="pun">.</span><span class="pln">display&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;SVG<br><br></span><span class="com">#NEED&nbsp;TO&nbsp;FIGURE&nbsp;OUT&nbsp;HOW&nbsp;TO&nbsp;MAKE&nbsp;THIS&nbsp;WORK:</span><span class="pln"><br></span><span class="com">#from&nbsp;graphviz&nbsp;import&nbsp;Source</span><span class="pln"><br><br></span><span class="kwd">import</span><span class="pln">&nbsp;pandas&nbsp;</span><span class="kwd">as</span><span class="pln">&nbsp;pd<br></span><span class="kwd">import</span><span class="pln">&nbsp;numpy&nbsp;</span><span class="kwd">as</span><span class="pln">&nbsp;np<br></span><span class="kwd">import</span><span class="pln">&nbsp;matplotlib</span><span class="pun">.</span><span class="pln">pyplot&nbsp;</span><span class="kwd">as</span><span class="pln">&nbsp;plt<br></span><span class="kwd">import</span><span class="pln">&nbsp;os<br></span><span class="kwd">import</span><span class="pln">&nbsp;pickle<br></span><span class="kwd">from</span><span class="pln">&nbsp;sqlalchemy&nbsp;</span><span class="kwd">import</span><span class="pln">&nbsp;create_engine<br><br></span><span class="kwd">import</span><span class="pln">&nbsp;funcs<br></span><span class="kwd">import</span><span class="pln">&nbsp;sql<br><br></span><span class="com">#auto&nbsp;import&nbsp;the&nbsp;funcs&nbsp;file</span><span class="pln"><br></span><span class="pun">%</span><span class="pln">load_ext&nbsp;autoreload<br></span><span class="pun">%</span><span class="pln">autoreload&nbsp;</span><span class="lit">1</span><span class="pln"><br></span><span class="pun">%</span><span class="pln">aimport&nbsp;funcs<br></span><span class="pun">%</span><span class="pln">aimport&nbsp;sql<br><br></span><span class="kwd">for</span><span class="pln">&nbsp;i&nbsp;</span><span class="kwd">in</span><span class="pln">&nbsp;range&nbsp;</span><span class="pun">(</span><span class="lit">1950</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="lit">2019</span><span class="pun">):</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ftp&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;FTP</span><span class="pun">(</span><span class="str">'ftp.cdc.noaa.gov'</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ftp</span><span class="pun">.</span><span class="pln">login</span><span class="pun">()</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ftp</span><span class="pun">.</span><span class="pln">cwd</span><span class="pun">(</span><span class="str">'/Datasets/ncep.reanalysis.dailyavgs/surface'</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;open</span><span class="pun">(</span><span class="str">"[name-of-directory]/y%s.nc"</span><span class="pln">&nbsp;</span><span class="pun">%</span><span class="pln">i</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'wb'</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ftp</span><span class="pun">.</span><span class="pln">retrbinary</span><span class="pun">(</span><span class="str">'RETR&nbsp;air.sig995.%s.nc'</span><span class="pln">&nbsp;</span><span class="pun">%</span><span class="pln">i</span><span class="pun">,</span><span class="pln">&nbsp;file</span><span class="pun">.</span><span class="pln">write</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ftp</span><span class="pun">.</span><span class="pln">quit</span><span class="pun">()</span><span class="pln"><br><br></span><span class="com">#run&nbsp;the&nbsp;resultant&nbsp;code&nbsp;printed&nbsp;by&nbsp;this&nbsp;in&nbsp;unix&nbsp;to&nbsp;concatenate&nbsp;all&nbsp;the&nbsp;new&nbsp;ncr&nbsp;files</span><span class="pln"><br>command&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">"ncrcat"</span><span class="pln"><br></span><span class="kwd">for</span><span class="pln">&nbsp;i&nbsp;</span><span class="kwd">in</span><span class="pln">&nbsp;range</span><span class="pun">(</span><span class="lit">1948</span><span class="pun">,</span><span class="lit">2018</span><span class="pun">):</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;command&nbsp;</span><span class="pun">+=</span><span class="pln">&nbsp;</span><span class="str">"&nbsp;y"</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;command&nbsp;</span><span class="pun">+=</span><span class="pln">&nbsp;str</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;command&nbsp;</span><span class="pun">+=</span><span class="pln">&nbsp;</span><span class="str">".nc"</span><span class="pln"><br>command&nbsp;</span><span class="pun">+=</span><span class="pln">&nbsp;</span><span class="str">"&nbsp;surface_temp.nc"</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">command</span><span class="pun">)</span><span class="pln"><br><br>os</span><span class="pun">.</span><span class="pln">environ</span><span class="pun">[</span><span class="str">"HDF5_USE_FILE_LOCKING"</span><span class="pun">]</span><span class="pln">&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">"FALSE"</span><span class="pln"><br><br>surface_temp&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="typ">Dataset</span><span class="pun">(</span><span class="str">"/home/aozerov/Dropbox/programming/jupyter/mathia/surface_temp.nc"</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'r'</span><span class="pun">,</span><span class="pln">&nbsp;format</span><span class="pun">=</span><span class="str">'NETCDF4'</span><span class="pun">)</span><span class="pln"><br><br>lats&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;surface_temp</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="str">'lat'</span><span class="pun">][:]</span><span class="pln"><br>lons&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;surface_temp</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="str">'lon'</span><span class="pun">][:]</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">lats</span><span class="pun">)</span><span class="pln"><br><br>time&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;surface_temp</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="str">'time'</span><span class="pun">][:]</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">surface_temp</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="str">'time'</span><span class="pun">][:])</span><span class="pln"><br>air&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;surface_temp</span><span class="pun">.</span><span class="pln">variables</span><span class="pun">[</span><span class="str">'air'</span><span class="pun">][:]</span><span class="pln"><br><br><br></span><span class="com">#&nbsp;Find&nbsp;the&nbsp;nearest&nbsp;latitude&nbsp;and&nbsp;longitude&nbsp;for&nbsp;0,0</span><span class="pln"><br>location&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="pun">{</span><span class="str">'name'</span><span class="pun">:</span><span class="pln">&nbsp;</span><span class="str">'0,0'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'lat'</span><span class="pun">:</span><span class="pln">&nbsp;</span><span class="lit">0</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'lon'</span><span class="pun">:</span><span class="pln">&nbsp;</span><span class="lit">0</span><span class="pun">}</span><span class="pln"><br>lat_idx&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">lats&nbsp;</span><span class="pun">-</span><span class="pln">&nbsp;location</span><span class="pun">[</span><span class="str">'lat'</span><span class="pun">]).</span><span class="pln">argmin</span><span class="pun">()</span><span class="pln"><br>lon_idx&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">lons&nbsp;</span><span class="pun">-</span><span class="pln">&nbsp;location</span><span class="pun">[</span><span class="str">'lon'</span><span class="pun">]).</span><span class="pln">argmin</span><span class="pun">()</span><span class="pln"><br><br></span><span class="com">#CREDIT&nbsp;TO&nbsp;JONATHAN&nbsp;MCDOWELL&nbsp;FOR&nbsp;HIS&nbsp;LAUNCHLOG.</span><span class="pln"><br></span><span class="com">#launchlog.csv&nbsp;is&nbsp;merely&nbsp;a&nbsp;slightly&nbsp;processed&nbsp;version&nbsp;of&nbsp;his&nbsp;log&nbsp;at:</span><span class="pln"><br></span><span class="com">#https://planet4589.org/space/log/launchlog.txt</span><span class="pln"><br>launches&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;pd</span><span class="pun">.</span><span class="pln">read_csv</span><span class="pun">(</span><span class="str">"[path-to]/launchlog.csv"</span><span class="pun">)</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launches</span><span class="pun">.</span><span class="pln">head</span><span class="pun">())</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launches</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launches</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">.</span><span class="pln">values</span><span class="pun">)</span><span class="pln"><br>launches&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launches</span><span class="pun">.</span><span class="pln">rename</span><span class="pun">(</span><span class="pln">columns</span><span class="pun">={</span><span class="str">'#&nbsp;Launch'</span><span class="pun">:</span><span class="pln">&nbsp;</span><span class="str">'launchnum'</span><span class="pun">})</span><span class="pln"><br>launchesp&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launches</span><span class="pun">[</span><span class="pln">launches</span><span class="pun">.</span><span class="pln">launchnum</span><span class="pun">.</span><span class="pln">notnull</span><span class="pun">()]</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launchesp</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br><br>coldel&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="pun">[</span><span class="str">'launchnum'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Ref'</span><span class="pun">,</span><span class="str">'Launch&nbsp;Date&nbsp;(UTC)'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'COSPAR'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'PL&nbsp;Name'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Orig&nbsp;PL&nbsp;Name'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'SATCAT'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'LV&nbsp;S/N'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;9'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;12'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;13'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;14'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;15'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;17'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;18'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;19'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;20'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;21'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'Unnamed:&nbsp;22'</span><span class="pun">]</span><span class="pln"><br>launchesp&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launchesp</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="pln">columns&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;coldel</span><span class="pun">)</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launchesp</span><span class="pun">.</span><span class="pln">columns</span><span class="pun">.</span><span class="pln">values</span><span class="pun">)</span><span class="pln"><br><br>launchesp</span><span class="pun">[</span><span class="str">"surfacetemp"</span><span class="pun">]</span><span class="pln">&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">nan<br><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"><br>timeadjust&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="pun">[]</span><span class="pln"><br>start&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;date</span><span class="pun">(</span><span class="lit">1800</span><span class="pun">,</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">)</span><span class="pln"><br></span><span class="kwd">for</span><span class="pln">&nbsp;i&nbsp;</span><span class="kwd">in</span><span class="pln">&nbsp;range&nbsp;</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">&nbsp;len</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)):</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;hours&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;time</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;days&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;hours</span><span class="pun">/</span><span class="lit">24</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;delta&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;timedelta</span><span class="pun">(</span><span class="pln">days</span><span class="pun">)</span><span class="pln">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="com">#&nbsp;Create&nbsp;a&nbsp;time&nbsp;delta&nbsp;object&nbsp;from&nbsp;the&nbsp;number&nbsp;of&nbsp;days</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;start&nbsp;</span><span class="pun">+</span><span class="pln">&nbsp;delta<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;timeadjust</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">offset</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">delta</span><span class="pun">)</span><span class="pln"><br><br></span><span class="com">#print&nbsp;temperature&nbsp;graph&nbsp;at&nbsp;0,0</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">np</span><span class="pun">.</span><span class="pln">arange</span><span class="pun">(</span><span class="lit">731</span><span class="pun">))</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">air</span><span class="pun">[:,</span><span class="pln">&nbsp;lat_idx</span><span class="pun">,</span><span class="pln">&nbsp;lon_idx</span><span class="pun">].</span><span class="pln">size</span><span class="pun">)</span><span class="pln"><br></span><span class="com">#np.column_stack((predictors_intercept,&nbsp;coefs_intercept))</span><span class="pln"><br>plt</span><span class="pun">.</span><span class="pln">figure</span><span class="pun">(</span><span class="pln">dpi</span><span class="pun">=</span><span class="lit">600</span><span class="pun">)</span><span class="pln"><br>plt</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">(</span><span class="pln">np</span><span class="pun">.</span><span class="pln">arange</span><span class="pun">(</span><span class="pln">air</span><span class="pun">[:,</span><span class="pln">&nbsp;lat_idx</span><span class="pun">,</span><span class="pln">&nbsp;lon_idx</span><span class="pun">].</span><span class="pln">size</span><span class="pun">),</span><span class="pln">&nbsp;air</span><span class="pun">[:,</span><span class="pln">lat_idx</span><span class="pun">,</span><span class="pln">lon_idx</span><span class="pun">],</span><span class="str">'-'</span><span class="pun">)</span><span class="pln"><br>plt</span><span class="pun">.</span><span class="pln">suptitle</span><span class="pun">(</span><span class="str">'Daily&nbsp;mean&nbsp;temperature&nbsp;near&nbsp;(0,0)&nbsp;since&nbsp;1948'</span><span class="pun">)</span><span class="pln"><br>plt</span><span class="pun">.</span><span class="pln">xlabel</span><span class="pun">(</span><span class="str">'Days&nbsp;since&nbsp;1948-01-1'</span><span class="pun">)</span><span class="pln"><br>plt</span><span class="pun">.</span><span class="pln">ylabel</span><span class="pun">(</span><span class="str">'Daily&nbsp;mean&nbsp;Temperature&nbsp;(K)'</span><span class="pun">)</span><span class="pln"><br>plt</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span><span class="pln"><br><br></span><span class="com">#CREDIT&nbsp;TO&nbsp;JONATHAN&nbsp;MCDOWELL&nbsp;FOR&nbsp;HIS&nbsp;LIST&nbsp;OF&nbsp;SITES.</span><span class="pln"><br></span><span class="com">#sites.csv&nbsp;is&nbsp;merely&nbsp;a&nbsp;slightly&nbsp;processed&nbsp;version&nbsp;of&nbsp;his&nbsp;list&nbsp;at:</span><span class="pln"><br></span><span class="com">#https://planet4589.org/space/lvdb/sdb/Sites</span><span class="pln"><br>sites&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;pd</span><span class="pun">.</span><span class="pln">read_csv</span><span class="pun">(</span><span class="str">"[path-to],sites2.csv"</span><span class="pun">)</span><span class="pln"><br>sites</span><span class="pun">.</span><span class="pln">head</span><span class="pun">()</span><span class="pln"><br><br></span><span class="com">#&nbsp;need&nbsp;to&nbsp;convert&nbsp;dates&nbsp;in&nbsp;launchesp&nbsp;to&nbsp;days*24&nbsp;since&nbsp;1948-01-01</span><span class="pln"><br>launch_surface_temps&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="pun">[]</span><span class="pln"><br></span><span class="kwd">for</span><span class="pln">&nbsp;i&nbsp;</span><span class="kwd">in</span><span class="pln">&nbsp;range&nbsp;</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">&nbsp;launchesp</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]):</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="com">#conver&nbsp;'LAUNCH&nbsp;DATE'&nbsp;column&nbsp;to&nbsp;date&nbsp;objects</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ldatestr&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launchesp</span><span class="pun">.</span><span class="pln">iloc</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="str">'LAUNCH&nbsp;DATE'</span><span class="pun">]</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="com">#ldateobj&nbsp;=&nbsp;datetime.strptime(ldatestr,&nbsp;'%Y-%m-%d').date()</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;ldateobj&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;date</span><span class="pun">(*</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">,</span><span class="pln">&nbsp;ldatestr</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'-'</span><span class="pun">)))</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">ldateobj</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;sourcedate&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;date</span><span class="pun">(</span><span class="lit">1948</span><span class="pun">,</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;tindex&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="pun">(</span><span class="pln">ldateobj</span><span class="pun">-</span><span class="pln">sourcedate</span><span class="pun">).</span><span class="pln">days<br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">tindex</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;sitestr&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launchesp</span><span class="pun">.</span><span class="pln">iloc</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="str">'Site'</span><span class="pun">]</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">sitestr</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">for</span><span class="pln">&nbsp;j&nbsp;</span><span class="kwd">in</span><span class="pln">&nbsp;range&nbsp;</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln">&nbsp;sites</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]):</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">if</span><span class="pln">&nbsp;sites</span><span class="pun">.</span><span class="pln">iloc</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="str">'code'</span><span class="pun">]</span><span class="pln">&nbsp;</span><span class="pun">==</span><span class="pln">&nbsp;sitestr</span><span class="pun">:</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lat&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;sites</span><span class="pun">.</span><span class="pln">iloc</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="str">'lat'</span><span class="pun">]</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">long</span><span class="pln">&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;sites</span><span class="pun">.</span><span class="pln">iloc</span><span class="pun">[</span><span class="pln">j</span><span class="pun">][</span><span class="str">'long'</span><span class="pun">]</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">break</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;lat_idx&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">lats&nbsp;</span><span class="pun">-</span><span class="pln">&nbsp;lat</span><span class="pun">).</span><span class="pln">argmin</span><span class="pun">()</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;lon_idx&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">lons&nbsp;</span><span class="pun">-</span><span class="pln">&nbsp;</span><span class="kwd">long</span><span class="pun">).</span><span class="pln">argmin</span><span class="pun">()</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;launch_surface_temp&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;air</span><span class="pun">[</span><span class="pln">tindex</span><span class="pun">,</span><span class="pln">lat_idx</span><span class="pun">,</span><span class="pln">lon_idx</span><span class="pun">]</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launch_surface_temp</span><span class="pun">)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;launch_surface_temps</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">launch_surface_temp</span><span class="pun">)</span><span class="pln"><br><br>launchesp</span><span class="pun">[</span><span class="str">'surfacetemp'</span><span class="pun">]</span><span class="pln">&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launch_surface_temps<br>launchesp</span><span class="pun">.</span><span class="pln">head</span><span class="pun">()</span><span class="pln"><br><br>launchesp_dummies&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;pd</span><span class="pun">.</span><span class="pln">get_dummies</span><span class="pun">(</span><span class="pln">launchesp</span><span class="pun">,</span><span class="pln">&nbsp;prefix</span><span class="pun">=[</span><span class="str">'LV&nbsp;Type_'</span><span class="pun">,</span><span class="str">'Site_'</span><span class="pun">],</span><span class="pln">&nbsp;columns</span><span class="pun">=[</span><span class="str">'LV&nbsp;Type'</span><span class="pun">,</span><span class="str">'Site'</span><span class="pun">])</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">launchesp_dummies</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"><br><br></span><span class="typ">Suc</span><span class="pln">&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launchesp_dummies</span><span class="pun">[</span><span class="str">'Suc'</span><span class="pun">]</span><span class="pln"><br>launchesp_dummies</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="pln">labels</span><span class="pun">=[</span><span class="str">'Suc'</span><span class="pun">],</span><span class="pln">&nbsp;axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln">inplace&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="kwd">True</span><span class="pun">)</span><span class="pln"><br>launchesp_dummies</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">(</span><span class="pln">labels</span><span class="pun">=[</span><span class="str">'LAUNCH&nbsp;DATE'</span><span class="pun">],</span><span class="pln">&nbsp;axis&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="lit">1</span><span class="pun">,</span><span class="pln">inplace&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="kwd">True</span><span class="pun">)</span><span class="pln"><br>launchesp_dummies</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="lit">428</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'suc'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="typ">Suc</span><span class="pun">)</span><span class="pln"><br>launchesp_dummies</span><span class="pun">.</span><span class="pln">head</span><span class="pun">()</span><span class="pln"><br><br>df2&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;launchesp_dummies<br>df2&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;df2</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'S'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"><br>df2&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;df2</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'F'</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="lit">0</span><span class="pun">)</span><span class="pln"><br>df&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;df2<br>df</span><span class="pun">[</span><span class="str">'suc'</span><span class="pun">].</span><span class="pln">mean</span><span class="pun">()</span><span class="pln"><br>df</span><span class="pun">.</span><span class="pln">drop</span><span class="pun">([</span><span class="pln">col&nbsp;</span><span class="kwd">for</span><span class="pln">&nbsp;col</span><span class="pun">,</span><span class="pln">&nbsp;val&nbsp;</span><span class="kwd">in</span><span class="pln">&nbsp;df</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">().</span><span class="pln">iteritems</span><span class="pun">()</span><span class="pln">&nbsp;</span><span class="kwd">if</span><span class="pln">&nbsp;val&nbsp;</span><span class="pun">&lt;</span><span class="pln">&nbsp;</span><span class="lit">10</span><span class="pun">],</span><span class="pln">&nbsp;axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln">&nbsp;inplace</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span><span class="pln"><br></span><span class="com">#for&nbsp;column&nbsp;in&nbsp;df2:</span><span class="pln"><br>&nbsp;</span><span class="com">#&nbsp;&nbsp;&nbsp;tot&nbsp;=&nbsp;df2.ix[0,].sum</span><span class="pln"><br>&nbsp;&nbsp;</span><span class="com">#&nbsp;&nbsp;print(tot)</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;</span><span class="com">#&nbsp;if&nbsp;tot&nbsp;&lt;&nbsp;10:</span><span class="pln"><br>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="com">#&nbsp;&nbsp;&nbsp;&nbsp;df.drop(labels=[column],&nbsp;axis=1,inplace&nbsp;=&nbsp;True)</span><span class="pln"><br>df</span><span class="pun">.</span><span class="pln">head</span><span class="pun">()</span><span class="pln"><br><br><br></span><span class="com">#create&nbsp;numpy&nbsp;arrays&nbsp;of&nbsp;the&nbsp;pandas&nbsp;dataframes</span><span class="pln"><br>npdata&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;df</span><span class="pun">.</span><span class="pln">values<br><br>length&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;npdata</span><span class="pun">.</span><span class="pln">shape</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">&nbsp;</span><span class="com">#get&nbsp;number&nbsp;of&nbsp;columns</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">length</span><span class="pun">)</span><span class="pln"><br><br></span><span class="com">#put&nbsp;all&nbsp;columns&nbsp;including&nbsp;and&nbsp;up&nbsp;to&nbsp;the&nbsp;last&nbsp;predictor&nbsp;into&nbsp;a&nbsp;numpy&nbsp;array</span><span class="pln"><br>x&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;npdata</span><span class="pun">[:,:(</span><span class="pln">length</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)]</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"><br><br></span><span class="com">#put&nbsp;last&nbsp;column&nbsp;(the&nbsp;response&nbsp;variable)&nbsp;into&nbsp;a&nbsp;numpy&nbsp;array</span><span class="pln"><br>y&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;npdata</span><span class="pun">[:,(</span><span class="pln">length</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)]</span><span class="pln"><br><br></span><span class="com">#add&nbsp;the&nbsp;3rd&nbsp;column&nbsp;squared&nbsp;as&nbsp;a&nbsp;predictor&nbsp;into&nbsp;column&nbsp;3&nbsp;(0-indexed)</span><span class="pln"><br>x&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="pln">np</span><span class="pun">.</span><span class="pln">power</span><span class="pun">(</span><span class="pln">x</span><span class="pun">[:,</span><span class="lit">3</span><span class="pun">],</span><span class="lit">2</span><span class="pun">),</span><span class="lit">1</span><span class="pun">)</span><span class="pln"><br><br>indices&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;df</span><span class="pun">.</span><span class="pln">columns&nbsp;</span><span class="com">#get&nbsp;column&nbsp;titles&nbsp;in&nbsp;the&nbsp;form&nbsp;of&nbsp;an&nbsp;array</span><span class="pln"><br>indices&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">indices</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="str">'col14^2'</span><span class="pun">)</span><span class="pln">&nbsp;</span><span class="com">#insert&nbsp;header&nbsp;for&nbsp;the&nbsp;new&nbsp;column&nbsp;14&nbsp;to&nbsp;maintain&nbsp;consistency&nbsp;with&nbsp;data</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">indices</span><span class="pun">)</span><span class="pln"><br><br>x_train</span><span class="pun">,</span><span class="pln">&nbsp;x_test</span><span class="pun">,</span><span class="pln">&nbsp;y_train</span><span class="pun">,</span><span class="pln">&nbsp;y_test&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;train_test_split</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">&nbsp;y</span><span class="pun">,</span><span class="pln">&nbsp;test_size</span><span class="pun">=</span><span class="lit">0.3</span><span class="pun">,</span><span class="pln">&nbsp;random_state&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="lit">42</span><span class="pun">)</span><span class="pln"><br><br></span><span class="com">#test&nbsp;with&nbsp;n&nbsp;predictors&nbsp;from&nbsp;1&nbsp;to&nbsp;40</span><span class="pln"><br>varresults&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;preds</span><span class="pun">.</span><span class="pln">optimize_var</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">130</span><span class="pun">,</span><span class="pln">indices</span><span class="pun">)</span><span class="pln">&nbsp;</span><span class="com">#save&nbsp;results&nbsp;to&nbsp;an&nbsp;array</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">grf</span><span class="pun">()</span><span class="pln">&nbsp;</span><span class="com">#graph&nbsp;results</span><span class="pln"><br><br>x_traint</span><span class="pun">,</span><span class="pln">&nbsp;x_testt</span><span class="pun">,</span><span class="pln">&nbsp;predictors&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;funcs</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">x_train</span><span class="pun">,</span><span class="pln">&nbsp;y_train</span><span class="pun">,</span><span class="pln">&nbsp;x_test</span><span class="pun">,</span><span class="pln">&nbsp;indices</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="lit">60</span><span class="pun">)</span><span class="pln"><br><br>preds&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;funcs</span><span class="pun">.</span><span class="typ">UniversalOptimizer</span><span class="pun">()</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="kwd">function</span><span class="pln">&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">"LogisticRegression"</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">set_data</span><span class="pun">(</span><span class="pln">x_traint</span><span class="pun">,</span><span class="pln">y_train</span><span class="pun">,</span><span class="pln">x_testt</span><span class="pun">,</span><span class="pln">y_test</span><span class="pun">)</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">func_init</span><span class="pun">()</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">penalty&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">'l1'</span><span class="pln">&nbsp;</span><span class="com">#penalty&nbsp;needs&nbsp;to&nbsp;be&nbsp;l1&nbsp;when&nbsp;solver&nbsp;is&nbsp;liblinear.&nbsp;Kernel&nbsp;dies&nbsp;otherwise</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">scorefunc&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">'roc_auc_score'</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">set_varscorer</span><span class="pun">(</span><span class="str">'f_classif'</span><span class="pun">)</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">preds</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">get_params</span><span class="pun">)</span><span class="pln"><br><br></span><span class="com">#optimize&nbsp;logisitc&nbsp;regression&nbsp;from&nbsp;a&nbsp;C&nbsp;value&nbsp;of&nbsp;10^-4&nbsp;to&nbsp;a&nbsp;C&nbsp;value&nbsp;of&nbsp;10^4</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">optimize_func</span><span class="pun">(-</span><span class="lit">20</span><span class="pun">,</span><span class="lit">20</span><span class="pun">,</span><span class="lit">1.5</span><span class="pun">,</span><span class="kwd">True</span><span class="pun">,</span><span class="str">'C'</span><span class="pun">)</span><span class="pln"><br>preds</span><span class="pun">.</span><span class="pln">grf</span><span class="pun">()</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">preds</span><span class="pun">.</span><span class="pln">model</span><span class="pun">.</span><span class="pln">coef_</span><span class="pun">.</span><span class="pln">ravel</span><span class="pun">())</span><span class="pln"><br><br></span><span class="com">#Create&nbsp;and&nbsp;fit&nbsp;a&nbsp;logistic&nbsp;regression&nbsp;model</span><span class="pln"><br>logreg&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="typ">LogisticRegression</span><span class="pun">(</span><span class="pln">penalty&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">'l1'</span><span class="pun">,</span><span class="pln">&nbsp;C&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="lit">100</span><span class="pun">,</span><span class="pln">&nbsp;solver&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">'liblinear'</span><span class="pun">,</span><span class="pln">&nbsp;random_state&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="lit">1</span><span class="pun">,</span><span class="pln">&nbsp;n_jobs&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="lit">1</span><span class="pun">)</span><span class="pln"><br>logreg</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">x_traint</span><span class="pun">,</span><span class="pln">&nbsp;y_train</span><span class="pun">)</span><span class="pln"><br><br></span><span class="com">#create&nbsp;numpy&nbsp;arrays&nbsp;of&nbsp;predicted&nbsp;probabilities</span><span class="pln"><br>trainpred_logreg&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;logreg</span><span class="pun">.</span><span class="pln">predict_proba</span><span class="pun">(</span><span class="pln">x_traint</span><span class="pun">)</span><span class="pln">&nbsp;</span><span class="com">#predict&nbsp;training&nbsp;probabilities</span><span class="pln"><br>trainpred_logreg&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="pln">trainpred_logreg</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,</span><span class="pln">axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">)</span><span class="pln">&nbsp;</span><span class="com">#remove&nbsp;column&nbsp;of&nbsp;probability&nbsp;of&nbsp;belonging&nbsp;to&nbsp;class&nbsp;0</span><span class="pln"><br><br>testpred_logreg&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;logreg</span><span class="pun">.</span><span class="pln">predict_proba</span><span class="pun">(</span><span class="pln">x_testt</span><span class="pun">)</span><span class="pln">&nbsp;</span><span class="com">#predict&nbsp;testing&nbsp;probabilities</span><span class="pln"><br>testpred_logreg&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="pln">testpred_logreg</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,</span><span class="pln">axis</span><span class="pun">=</span><span class="lit">1</span><span class="pun">)</span><span class="pln">&nbsp;</span><span class="com">#remove&nbsp;column&nbsp;of&nbsp;probability&nbsp;of&nbsp;belonging&nbsp;to&nbsp;class&nbsp;0</span><span class="pln"><br><br></span><span class="kwd">print</span><span class="pun">(</span><span class="str">'train&nbsp;area&nbsp;under&nbsp;roc&nbsp;curve:'</span><span class="pun">,</span><span class="pln">&nbsp;roc_auc_score</span><span class="pun">(</span><span class="pln">y_train</span><span class="pun">,</span><span class="pln">trainpred_logreg</span><span class="pun">))</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="str">'test&nbsp;area&nbsp;under&nbsp;roc&nbsp;curve:'</span><span class="pun">,</span><span class="pln">&nbsp;roc_auc_score</span><span class="pun">(</span><span class="pln">y_test</span><span class="pun">,</span><span class="pln">testpred_logreg</span><span class="pun">))</span><span class="pln"><br><br>funcs</span><span class="pun">.</span><span class="pln">plot_roc</span><span class="pun">(</span><span class="pln">y_test</span><span class="pun">,</span><span class="pln">&nbsp;testpred_logreg</span><span class="pun">)</span><span class="pln"><br><br>coefs&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;logreg</span><span class="pun">.</span><span class="pln">coef_</span><span class="pun">.</span><span class="pln">ravel</span><span class="pun">()</span><span class="pln"><br>predictors_intercept&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">predictors</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="lit">0</span><span class="pun">,</span><span class="pln">&nbsp;</span><span class="str">'intercept'</span><span class="pun">)</span><span class="pln"><br>coefs_intercept&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">insert</span><span class="pun">(</span><span class="pln">coefs</span><span class="pun">,</span><span class="lit">0</span><span class="pun">,</span><span class="pln">logreg</span><span class="pun">.</span><span class="pln">intercept_</span><span class="pun">)</span><span class="pln"><br>predcoefs&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;np</span><span class="pun">.</span><span class="pln">column_stack</span><span class="pun">((</span><span class="pln">predictors_intercept</span><span class="pun">,</span><span class="pln">&nbsp;coefs_intercept</span><span class="pun">))</span><span class="pln"><br></span><span class="kwd">print</span><span class="pun">(</span><span class="pln">predcoefs</span><span class="pun">)</span><span class="pln"><br><br>np</span><span class="pun">.</span><span class="pln">savetxt</span><span class="pun">(</span><span class="str">"[path-to]/ytrain.csv"</span><span class="pun">,</span><span class="pln">&nbsp;y_train</span><span class="pun">,</span><span class="pln">&nbsp;delimiter&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="str">','</span><span class="pun">,</span><span class="pln">&nbsp;fmt&nbsp;</span><span class="pun">=</span><span class="pln">&nbsp;</span><span class="pun">(</span><span class="str">'%s'</span><span class="pun">))</span></pre>
<!--<p>Here is my full report on this research:</p>
<a href="/research/rocketfailure/rocketfailure.pdf">A "Big Data" Analysis of Rocket Failure (2019)</a>-->

<!--#include virtual="/footer.html"-->
